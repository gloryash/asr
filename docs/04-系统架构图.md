# 系统架构图

> 文档版本：v2.0
> 更新日期：2026-01-29
> 技术栈：React 19 + TypeScript + Vite

---

## 1. 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户界面层                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    index.html                            │   │
│  │              (演示页面 / 可视化界面)                       │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         业务逻辑层                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  VoiceChatEngine                         │   │
│  │                    (对话引擎)                             │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │            InterviewRecorder                     │    │   │
│  │  │              (访谈记录模块)                        │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         基础能力层                               │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐       │
│  │ Recorder  │ │  Player   │ │    VAD    │ │  Config   │       │
│  │  录音模块  │ │  播放模块  │ │ 活动检测   │ │  配置管理  │       │
│  └───────────┘ └───────────┘ └───────────┘ └───────────┘       │
│  ┌───────────────────────┐ ┌───────────────────────┐           │
│  │      ASR Client       │ │      TTS Client       │           │
│  │      语音识别客户端     │ │      语音合成客户端     │           │
│  └───────────────────────┘ └───────────────────────┘           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         外部服务层                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                阿里云 DashScope API                       │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐                  │   │
│  │  │Paraformer│  │CosyVoice│  │  Qwen   │                  │   │
│  │  │  (ASR)   │  │  (TTS)  │  │  (LLM)  │                  │   │
│  │  └─────────┘  └─────────┘  └─────────┘                  │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 数据流图

```
用户说话
    │
    ▼
┌──────────┐    PCM数据     ┌──────────┐
│ Recorder │ ─────────────▶ │   VAD    │
└──────────┘                └──────────┘
    │                            │
    │ PCM数据                    │ 语音事件
    ▼                            ▼
┌──────────┐    识别文本    ┌──────────────────┐
│   ASR    │ ─────────────▶ │ VoiceChatEngine  │
└──────────┘                └──────────────────┘
                                  │
                                  │ 用户文本
                                  ▼
                            ┌──────────┐
                            │   LLM    │ (外部API)
                            └──────────┘
                                  │
                                  │ AI回复
                                  ▼
                            ┌──────────┐
                            │   TTS    │
                            └──────────┘
                                  │
                                  │ PCM音频
                                  ▼
                            ┌──────────┐
                            │  Player  │
                            └──────────┘
                                  │
                                  ▼
                              播放语音
```

---

## 3. 访谈记录数据流

```
┌──────────────────┐
│ VoiceChatEngine  │
└──────────────────┘
         │
         │ onUserText / onAIText
         ▼
┌──────────────────┐
│InterviewRecorder │
└──────────────────┘
         │
         │ 记录存储
         ▼
┌──────────────────┐
│   RecordEntry[]  │
└──────────────────┘
         │
         │ 导出
         ▼
┌─────┬─────┬──────┐
│JSON │ TXT │  MD  │
└─────┴─────┴──────┘
```

---

## 4. 文件结构

```
voice-chat-demo/
├── docs/                       # 产品文档
├── public/                     # 静态资源
│   ├── workers/                # Web Workers
│   │   ├── audioProcessor.js   # 录音处理
│   │   ├── pcmPlayerWorklet.js # 播放处理
│   │   └── asrWorker.js        # ASR Worker
│   └── js/
│       └── paraformerRealtimeApi.js
├── src/
│   ├── components/             # UI 组件
│   │   ├── CenterChat.tsx      # 中间对话面板
│   │   ├── ChatHistory.tsx     # 对话记录
│   │   └── SettingsPanel.tsx   # 设置面板
│   ├── hooks/                  # React Hooks
│   │   ├── useRealtimeVoiceChat.ts
│   │   ├── useVoiceInteraction.ts
│   │   ├── useAudioRecorder.ts
│   │   ├── useAudioPlayer.ts
│   │   ├── useASR.ts
│   │   └── useTTS.ts
│   ├── services/               # 服务层
│   │   ├── audio/              # 音频处理
│   │   ├── asr/                # ASR 服务
│   │   ├── tts/                # TTS 服务
│   │   ├── chat/               # LLM 对话
│   │   └── voice/              # VAD 等
│   ├── stores/                 # 状态管理
│   └── types/                  # TypeScript 类型
├── index.html
├── package.json
└── README.md
```
