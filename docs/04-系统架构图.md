# 系统架构图

> 文档版本：v1.0
> 更新日期：2025-01-27

---

## 1. 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户界面层                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    index.html                            │   │
│  │              (演示页面 / 可视化界面)                       │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         业务逻辑层                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  VoiceChatEngine                         │   │
│  │                    (对话引擎)                             │   │
│  │  ┌─────────────────────────────────────────────────┐    │   │
│  │  │            InterviewRecorder                     │    │   │
│  │  │              (访谈记录模块)                        │    │   │
│  │  └─────────────────────────────────────────────────┘    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         基础能力层                               │
│  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐       │
│  │ Recorder  │ │  Player   │ │    VAD    │ │  Config   │       │
│  │  录音模块  │ │  播放模块  │ │ 活动检测   │ │  配置管理  │       │
│  └───────────┘ └───────────┘ └───────────┘ └───────────┘       │
│  ┌───────────────────────┐ ┌───────────────────────┐           │
│  │      ASR Client       │ │      TTS Client       │           │
│  │      语音识别客户端     │ │      语音合成客户端     │           │
│  └───────────────────────┘ └───────────────────────┘           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         外部服务层                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                阿里云 DashScope API                       │   │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐                  │   │
│  │  │Paraformer│  │CosyVoice│  │  Qwen   │                  │   │
│  │  │  (ASR)   │  │  (TTS)  │  │  (LLM)  │                  │   │
│  │  └─────────┘  └─────────┘  └─────────┘                  │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. 数据流图

```
用户说话
    │
    ▼
┌──────────┐    PCM数据     ┌──────────┐
│ Recorder │ ─────────────▶ │   VAD    │
└──────────┘                └──────────┘
    │                            │
    │ PCM数据                    │ 语音事件
    ▼                            ▼
┌──────────┐    识别文本    ┌──────────────────┐
│   ASR    │ ─────────────▶ │ VoiceChatEngine  │
└──────────┘                └──────────────────┘
                                  │
                                  │ 用户文本
                                  ▼
                            ┌──────────┐
                            │   LLM    │ (外部API)
                            └──────────┘
                                  │
                                  │ AI回复
                                  ▼
                            ┌──────────┐
                            │   TTS    │
                            └──────────┘
                                  │
                                  │ PCM音频
                                  ▼
                            ┌──────────┐
                            │  Player  │
                            └──────────┘
                                  │
                                  ▼
                              播放语音
```

---

## 3. 访谈记录数据流

```
┌──────────────────┐
│ VoiceChatEngine  │
└──────────────────┘
         │
         │ onUserText / onAIText
         ▼
┌──────────────────┐
│InterviewRecorder │
└──────────────────┘
         │
         │ 记录存储
         ▼
┌──────────────────┐
│   RecordEntry[]  │
└──────────────────┘
         │
         │ 导出
         ▼
┌─────┬─────┬──────┐
│JSON │ TXT │  MD  │
└─────┴─────┴──────┘
```

---

## 4. 文件结构

```
voice-chat-module/
├── docs/                    # 产品文档
│   ├── 01-用户画像.md
│   ├── 02-产品需求文档.md
│   ├── 03-模块设计文档.md
│   └── 04-系统架构图.md
├── js/                      # 源代码
│   ├── config.js            # 配置管理
│   ├── audioRecorder.js     # 录音模块
│   ├── audioPlayer.js       # 播放模块
│   ├── vad.js               # VAD模块
│   ├── asrClient.js         # ASR客户端
│   ├── ttsClient.js         # TTS客户端
│   ├── voiceChatEngine.js   # 对话引擎
│   └── interviewRecorder.js # 访谈记录(待开发)
├── index.html               # 演示页面
├── test_api.py              # API测试
└── README.md                # 项目说明
```
