# 访谈记录模块设计文档

> 文档版本：v1.0
> 更新日期：2025-01-27
> 文档状态：设计中

---

## 1. 功能概述

### 1.1 背景

老板反馈：语音交互到PRD之间缺了一步——访谈逐字稿/记录。需要把中间环节的输入输出显性化。

### 1.2 目标

提供访谈记录功能，将语音对话内容结构化存储并支持导出。

### 1.3 输入/输出

| 类型 | 格式 | 说明 |
|------|------|------|
| 输入 | 对话事件 | role + content + timestamp |
| 输出 | 结构化记录 | JSON / TXT / Markdown |

---

## 2. 数据结构

### 2.1 单条记录 (RecordEntry)

```javascript
{
  id: "entry_001",           // 唯一标识
  timestamp: 1706345678000,  // 时间戳(ms)
  role: "user",              // user | assistant
  content: "你好，我想了解一下产品功能",
  duration: 2500             // 语音时长(ms)，可选
}
```

### 2.2 完整访谈记录 (InterviewRecord)

```javascript
{
  id: "interview_20250127_001",
  title: "用户访谈-产品功能调研",
  startTime: 1706345600000,
  endTime: 1706347200000,
  entries: [RecordEntry, ...]
}
```

---

## 3. 接口设计

### 3.1 类定义

```javascript
class InterviewRecorder {
  constructor()

  // 开始新访谈
  startNewInterview(title?: string): string

  // 添加记录
  addEntry(role: 'user' | 'assistant', content: string): void

  // 结束访谈
  endInterview(): InterviewRecord

  // 导出
  exportAsJSON(): string
  exportAsText(): string
  exportAsMarkdown(): string

  // 获取记录
  getCurrentRecord(): InterviewRecord | null
  getAllRecords(): InterviewRecord[]
}
```

---

## 4. 导出格式示例

### 4.1 JSON 格式

```json
{
  "id": "interview_20250127_001",
  "title": "用户访谈",
  "startTime": 1706345600000,
  "endTime": 1706347200000,
  "entries": [
    {
      "timestamp": 1706345610000,
      "role": "user",
      "content": "你好"
    },
    {
      "timestamp": 1706345615000,
      "role": "assistant",
      "content": "你好！有什么可以帮助你的？"
    }
  ]
}
```

### 4.2 TXT 格式

```
访谈记录：用户访谈
时间：2025-01-27 10:00 - 10:30
================================

[10:00:10] 用户：你好

[10:00:15] AI：你好！有什么可以帮助你的？
```

### 4.3 Markdown 格式

```markdown
# 访谈记录：用户访谈

**时间**：2025-01-27 10:00 - 10:30

---

**用户** (10:00:10)
> 你好

**AI** (10:00:15)
> 你好！有什么可以帮助你的？
```

---

## 5. 集成方案

### 5.1 与 VoiceChatEngine 集成

```javascript
// 在 VoiceChatEngine 中添加
this.recorder = new InterviewRecorder();

// 监听用户文本
this.onUserText = (text, isFinal) => {
  if (isFinal) {
    this.recorder.addEntry('user', text);
  }
};

// 监听 AI 回复
this.onAIText = (text) => {
  this.recorder.addEntry('assistant', text);
};
```

### 5.2 UI 集成

在 index.html 中添加：
- 「开始记录」按钮
- 「结束记录」按钮
- 「导出」下拉菜单（JSON/TXT/MD）

---

## 6. 实现计划

| 步骤 | 任务 | 状态 |
|------|------|------|
| 1 | 创建 interviewRecorder.js | 待开发 |
| 2 | 实现数据结构和基础方法 | 待开发 |
| 3 | 实现导出功能 | 待开发 |
| 4 | 集成到 VoiceChatEngine | 待开发 |
| 5 | 更新 UI 界面 | 待开发 |
| 6 | 测试和文档 | 待开发 |
